<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Autocomplete with Highlighted Input</title>
  <link rel="stylesheet" href="../css/general/themes.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <style>

    .searchbar {
      position: relative;
      height: 45px;
      width: 50%;
      max-width: 450px;
      min-width: 300px;
      background: var(--searchbar);
      border-radius: 50px;
      display: flex;
    }


    .searchbar input {
      border: none;
      background-color: transparent;
      width: 100%;
      font-size: 16px;
      padding-left: 50px;
      color: var(--text);
    }

    .searchbar input::placeholder {
      color: var(--less-important);
    }

    .searchbar #search-icon {
      position: absolute;
      top: 10px;
      left: 20px;
      color: var(--important);
    }


    .searchbar ul i {
      margin-right: 5px;
      color: var(--placeholder);
      font-size: 18px;
    }

    .searchbar ul #folder-search-type{color: #5c7fdd}
    .searchbar ul #note-search-type {color: #a8b2ff}
    .searchbar ul #template-search-type {color: #abb8ff}


    .autocomplete-container input[type="text"] {
      padding: 8px;
      font-size: 14px;
      width: 100%;
      border: 1px solid #ccc;
      position: relative;
      background: transparent;
    }

    .dropdown-items {
      position: absolute;
      top: 60px;
      left: -1px;
      z-index: 1;
      width: 100%;
      min-width: 300px;
      max-height: 350px;
      overflow-y: auto;
      border: var(--border-sidebar-right);
      border-radius: 10px;
      background: var(--dropdown);
      list-style: none;
      margin: 0;
      padding: 10px;
      opacity: 0;
      visibility: hidden;
      transition: 150ms;
    }


    .dropdown-items li {
      cursor: pointer;
      font-size: 16px;
      margin: 10px;
      padding: 10px;
      color: var(--editor-text);
      border-radius: 5px;
      transition: background-color 150ms ease
    }

    .dropdown-items i {
      margin-right: 10px;
    }

    .dropdown-items li:hover {
      background-color: var(--hover-searchbar-options);
    }

    .dropdown-items li.highlighted {
      background-color: #d3d3d3;
    }

    .highlight {
      color: #5c7fdd;
    }
  </style>
</head>
<body>

<autocomplete-search></autocomplete-search>

<script>
  // Create the Custom Web Component: autocomplete-search
  class AutocompleteSearch extends HTMLElement {
    constructor() {
      super();
      this.selectedIndex = -1;
      this.currentSuggestions = [];
    }

    connectedCallback() {
      this.render();
      this.setupEventListeners();
    }

    render() {
      this.innerHTML = `
      <div class="searchbar">
        <i id="search-icon" class="bi bi-search"></i>
        <input type="text" placeholder="Search..." spellcheck="false">
        <ul class="dropdown-items"></ul>
      </div>
    `;
    }

    setupEventListeners() {
      const input = this.querySelector('input[type="text"]');
      input.addEventListener("input", (event) => this.handleInput(event));
      input.addEventListener("keydown", (event) => this.handleKeyDown(event));
    }

    handleInput(event) {
      const inputValue = event.target.value.toLowerCase();
      this.currentSuggestions = this.getSuggestions(inputValue);
      this.displaySuggestions(inputValue);
      this.selectedIndex = -1; // Reset index on input change
    }

    handleKeyDown(event) {
      const input = this.querySelector('input[type="text"]');

      if (event.key === "Enter") {
        event.preventDefault();
        if (this.selectedIndex >= 0 && this.currentSuggestions[this.selectedIndex]) {
          input.value = this.currentSuggestions[this.selectedIndex].text;
          this.clearSuggestions();
        } else if (this.currentSuggestions.length > 0) {
          input.value = this.currentSuggestions[0].text;
          this.clearSuggestions();
        }
      }

      if (event.key === "ArrowDown") {
        event.preventDefault();
        if (this.selectedIndex < this.currentSuggestions.length - 1) {
          this.selectedIndex++;
          this.updateHighlightedSuggestion();
        }
      }

      if (event.key === "ArrowUp") {
        event.preventDefault();
        if (this.selectedIndex > 0) {
          this.selectedIndex--;
          this.updateHighlightedSuggestion();
        } else {
          this.selectedIndex = -1;
          this.updateHighlightedSuggestion();
        }
      }
    }

    getSuggestions(query) {
      const allSuggestions = ["Projects", "Personal", "Work", "Tasks", "MeetingNotes", "ShoppingList", "ProjectPlan"];
      if (!query) return [];

      return allSuggestions.filter(item => item.toLowerCase().includes(query))
              .map(item => ({ text: item, match: this.getHighlightedText(item, query) }));
    }

    getHighlightedText(text, query) {
      const index = text.toLowerCase().indexOf(query);
      if (index === -1) return text; // No match found

      // Highlight the part of the suggestion that matches the query
      const before = text.slice(0, index);
      const match = text.slice(index, index + query.length);
      const after = text.slice(index + query.length);

      return `${before}<span class="highlight">${match}</span>${after}`;
    }

    displaySuggestions(query) {
      const suggestionsDiv = this.querySelector(".dropdown-items");
      suggestionsDiv.innerHTML = ""; // Clear previous suggestions

      this.currentSuggestions.forEach((suggestion, index) => {
        const li = document.createElement("li");
        li.innerHTML = suggestion.match; // Insert the highlighted text
        if (index === this.selectedIndex) {
          li.classList.add("highlighted");
        }
        li.addEventListener("mousedown", () => {
          this.querySelector('input[type="text"]').value = suggestion.text;
          this.clearSuggestions();
        });
        suggestionsDiv.appendChild(li);
      });

      suggestionsDiv.style.display = this.currentSuggestions.length > 0 ? "block" : "none";
    }

    updateHighlightedSuggestion() {
      const suggestionItems = this.querySelectorAll(".dropdown-items li");
      suggestionItems.forEach((item, index) => {
        if (index === this.selectedIndex) {
          item.classList.add("highlighted");
        } else {
          item.classList.remove("highlighted");
        }
      });
    }

    clearSuggestions() {
      this.querySelector(".dropdown-items").innerHTML = "";
      this.currentSuggestions = [];
      this.selectedIndex = -1;
    }
  }

  // Define the custom element
  customElements.define('autocomplete-search', AutocompleteSearch);
</script>

</body>
</html>
